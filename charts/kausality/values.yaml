# Default values for kausality

# Webhook replica count. Set to 2+ for high availability.
# Rolling updates use maxUnavailable=0, maxSurge=1 to ensure
# at least one pod is always running during upgrades.
replicaCount: 1

image:
  repository: ghcr.io/kausality-io/kausality
  pullPolicy: IfNotPresent
  tag: ""  # Defaults to appVersion

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true

service:
  type: ClusterIP
  port: 443

resources:
  limits:
    cpu: 500m
    memory: 128Mi
  requests:
    cpu: 10m
    memory: 64Mi

nodeSelector: {}

tolerations: []

affinity: {}

# Webhook configuration
webhook:
  # Port the webhook server listens on
  port: 9443
  # Health probe bind address
  healthProbeBindAddress: ":8081"

# Certificate configuration
# cert-manager or self-signed certificates
certificates:
  # Use cert-manager to manage certificates
  certManager:
    enabled: false
    issuerRef:
      name: ""
      kind: Issuer  # or ClusterIssuer
  # Use self-signed certificates (generated by Helm)
  selfSigned:
    enabled: true

# Namespaces to exclude from drift detection (used by policy controller)
excludeNamespaces:
  - kube-system
  - kube-public
  - kube-node-lease

# Logging configuration
logging:
  # Log level (debug, info, warn, error)
  level: info
  # Development mode (more verbose)
  development: false

# Drift callbacks configuration
# Multiple backends can be configured; reports are sent to all in parallel
driftCallbacks: []
  # Example configuration:
  # - url: https://backend1.example.com/webhook
  #   ca:
  #     # Inline CA certificate (PEM format)
  #     cert: ""
  #     # Or use existing secret
  #     existingSecret: ""
  #     # Key in the secret to use (default: ca.crt)
  #     # Use "tls.crt" for cert-manager secrets
  #     key: "ca.crt"
  #   timeout: 10s
  #   retryCount: 3
  #   retryInterval: 1s
  # - url: https://backend2.example.com/webhook
  #   timeout: 5s

# Controller deployment (reconciles Kausality CRDs, manages webhook configuration)
controller:
  enabled: true

  replicaCount: 1

  image:
    repository: ghcr.io/kausality-io/kausality-controller
    pullPolicy: IfNotPresent
    tag: ""  # Defaults to appVersion

  # Metrics bind address
  metricsBindAddress: ":8080"
  # Health probe bind address
  healthProbeBindAddress: ":8081"
  # Enable leader election for HA
  leaderElect: false

  resources:
    limits:
      cpu: 100m
      memory: 64Mi
    requests:
      cpu: 10m
      memory: 32Mi

  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Backend deployment for receiving drift reports
# Deploys kausality-backend-log which logs DriftReports as YAML
backend:
  enabled: false

  replicaCount: 1

  image:
    repository: ghcr.io/kausality-io/kausality-backend-log
    pullPolicy: IfNotPresent
    tag: ""  # Defaults to appVersion

  service:
    type: ClusterIP
    port: 8080

  # Extra arguments to pass to the backend
  extraArgs: []
  # - --some-flag=value

  # Extra environment variables
  extraEnv: []
  # - name: MY_VAR
  #   value: "my-value"

  # Extra environment variables from secrets/configmaps
  extraEnvFrom: []
  # - secretRef:
  #     name: my-secret

  # Extra volume mounts
  extraVolumeMounts: []
  # - name: my-secret
  #   mountPath: /etc/my-secret
  #   readOnly: true

  # Extra volumes
  extraVolumes: []
  # - name: my-secret
  #   secret:
  #     secretName: my-secret

  resources:
    limits:
      cpu: 100m
      memory: 64Mi
    requests:
      cpu: 10m
      memory: 32Mi

  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}

# TUI Backend deployment for interactive drift management
# Deploys kausality-backend-tui which provides a terminal UI
backendTui:
  enabled: false

  replicaCount: 1

  image:
    repository: ghcr.io/kausality-io/kausality-backend-tui
    pullPolicy: IfNotPresent
    tag: ""  # Defaults to appVersion

  service:
    type: ClusterIP
    port: 8081

  # Extra arguments to pass to the backend
  extraArgs: []

  # Extra environment variables
  extraEnv: []

  # Extra environment variables from secrets/configmaps
  extraEnvFrom: []

  # Extra volume mounts
  extraVolumeMounts: []

  # Extra volumes
  extraVolumes: []

  resources:
    limits:
      cpu: 100m
      memory: 64Mi
    requests:
      cpu: 10m
      memory: 32Mi

  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
